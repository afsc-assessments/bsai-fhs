<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maia Kapur maia.kapur@noaa.gov">

<title>2024 BSAI FHS Bridging Analyses</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="2024_bridging_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="2024_bridging_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="2024_bridging_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="2024_bridging_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2024_bridging_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="2024_bridging_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2024_bridging_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2024_bridging_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2024_bridging_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2024_bridging_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#stock-synthesis-software-update-3.30.22" id="toc-stock-synthesis-software-update-3.30.22" class="nav-link" data-scroll-target="#stock-synthesis-software-update-3.30.22">Stock Synthesis Software Update 3.30.22</a>
  <ul class="collapse">
  <li><a href="#warnings" id="toc-warnings" class="nav-link" data-scroll-target="#warnings">Warnings</a></li>
  <li><a href="#likelihood-components" id="toc-likelihood-components" class="nav-link" data-scroll-target="#likelihood-components">Likelihood Components</a></li>
  <li><a href="#ss3-bridging-conclusion" id="toc-ss3-bridging-conclusion" class="nav-link" data-scroll-target="#ss3-bridging-conclusion">SS3 Bridging Conclusion</a></li>
  </ul></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">Data Exploration</a>
  <ul class="collapse">
  <li><a href="#big-picture-data-notes" id="toc-big-picture-data-notes" class="nav-link" data-scroll-target="#big-picture-data-notes">Big-Picture Data Notes</a></li>
  <li><a href="#fishery-catches" id="toc-fishery-catches" class="nav-link" data-scroll-target="#fishery-catches">Fishery Catches</a></li>
  <li><a href="#fishery-length-compositions" id="toc-fishery-length-compositions" class="nav-link" data-scroll-target="#fishery-length-compositions">Fishery Length Compositions</a></li>
  <li><a href="#fishery-age-compositions" id="toc-fishery-age-compositions" class="nav-link" data-scroll-target="#fishery-age-compositions">Fishery Age Compositions</a></li>
  <li><a href="#survey-biomass-data" id="toc-survey-biomass-data" class="nav-link" data-scroll-target="#survey-biomass-data">Survey Biomass Data</a></li>
  <li><a href="#survey-compositional-data" id="toc-survey-compositional-data" class="nav-link" data-scroll-target="#survey-compositional-data">Survey Compositional Data</a></li>
  <li><a href="#survey-marginal-lengths" id="toc-survey-marginal-lengths" class="nav-link" data-scroll-target="#survey-marginal-lengths">Survey Marginal Lengths</a></li>
  <li><a href="#survey-ages-ghosted" id="toc-survey-ages-ghosted" class="nav-link" data-scroll-target="#survey-ages-ghosted">Survey Ages (ghosted)</a></li>
  </ul></li>
  <li><a href="#data-bridging" id="toc-data-bridging" class="nav-link" data-scroll-target="#data-bridging">Data Bridging</a>
  <ul class="collapse">
  <li><a href="#timeseries-prep" id="toc-timeseries-prep" class="nav-link" data-scroll-target="#timeseries-prep">Timeseries Prep</a></li>
  <li><a href="#adding-catches" id="toc-adding-catches" class="nav-link" data-scroll-target="#adding-catches">Adding Catches</a></li>
  <li><a href="#adding-survey-biomass" id="toc-adding-survey-biomass" class="nav-link" data-scroll-target="#adding-survey-biomass">Adding Survey Biomass</a></li>
  <li><a href="#adding-survey-caals" id="toc-adding-survey-caals" class="nav-link" data-scroll-target="#adding-survey-caals">Adding Survey CAALs</a></li>
  <li><a href="#adding-fishery-lengths" id="toc-adding-fishery-lengths" class="nav-link" data-scroll-target="#adding-fishery-lengths">Adding Fishery Lengths</a></li>
  <li><a href="#adding-fishery-ages" id="toc-adding-fishery-ages" class="nav-link" data-scroll-target="#adding-fishery-ages">Adding Fishery Ages</a></li>
  <li><a href="#marginal-survey-ages-lengths-ghosted" id="toc-marginal-survey-ages-lengths-ghosted" class="nav-link" data-scroll-target="#marginal-survey-ages-lengths-ghosted">Marginal Survey Ages &amp; Lengths (ghosted)</a></li>
  </ul></li>
  <li><a href="#bridged-operational-update-model-18.2c-2024" id="toc-bridged-operational-update-model-18.2c-2024" class="nav-link" data-scroll-target="#bridged-operational-update-model-18.2c-2024">Bridged Operational Update Model, 18.2c (2024)</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2024 BSAI FHS Bridging Analyses</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maia Kapur maia.kapur@noaa.gov </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="overview" class="level1">
<h1>Overview</h1>
<p>This electronic document describes the analyses undertaken to bridge the last “full” assessment of BSAI Flathead Sole (Monnahan, 2020) into the latest Stock Synthesis (SS3) software version, as well as explorations of sequential inclusion of recent data.</p>
<p>The general workflow was as follows:</p>
<ol type="1">
<li><p>Move the 2020 model, referred to as Model 18.2c (2020), from SS3 version 3.30.16 to the the newest SS3 software version as of December 2023 (3.30.22) downloaded from the <a href="https://github.com/nmfs-ost/ss3-source-code/releases">NOAA Virtual Lab</a>. Comparisons between model derived quantities and likelihoods are provided in this document.</p></li>
<li><p>Compare the historical and newly-pulled data. The “old data pull approach” uses code from Drs. McGilliard &amp; Monnahan in a local R package entitled <code>newsbss</code>, which is highly customized and not actively maintained. The “newly-pulled” data are obtained using the <code>afscdata</code> package. The latter is the preferred method since it is actively maintained and provides a unified approach for many stocks. For many data sources I ran the 2020 model with <em>only</em> that data source changed, when I needed to convince myself that trivial differences in the raw data extraction were indeed trivially impactful.</p></li>
<li><p>Sequentially bridge the data obtained via <code>afscdata</code> Model 18.2c (2020) has catches and fishery length comps through 2020, and everything else through 2019. There was also mean size-at-age data through 2016 but it was not used (fit to) in the model. We added catches through 2023, with an estimate of 2024 catches, then survey abundance indices, then survey lengths, then survey CAALs (marginal ages are ghosted, but included as well), then fishery lengths, then fishery ages. The impact of each of these five steps is documented below. <strong>This bridged model, with updated software and data inputs but no structural changes is labeled as Model 18.2c (2024)</strong>.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Data used in model Model 18.2c (2020). Most of these will be updated with at least 3 years of data for the bridged model, with the exception of fishery age compositions; there was not enough age-reader time to complete otolith reads for 2022 and 2023 (more details below). Also note that while there are fishery length data for most of the time series, fitting to these data is disabled in years where fishery ages are available.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="stock-synthesis-software-update-3.30.22" class="level1">
<h1>Stock Synthesis Software Update 3.30.22</h1>
<section id="warnings" class="level2">
<h2 class="anchored" data-anchor-id="warnings">Warnings</h2>
<p>Model 18.2c (2020) had generic warnings about the <code>recr_dist</code> method, poor <span class="math inline">\(F_{MSY}\)</span> convergence, and an issue with the final gradient. Only the latter is of concern. Model 18.2c run with the new SS3 software threw the same warnings as well as an indication that the initial value for <code>parm 11</code> was greater than the max (<code>999\&gt;5</code>); this is the end logit for the survey selex (forcing it to be asymptotic). I am comfortable with the consistency of these warnings and clean them up below; the gradient is identical between models (0.0015022).</p>
</section>
<section id="likelihood-components" class="level2">
<h2 class="anchored" data-anchor-id="likelihood-components">Likelihood Components</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Model 18.2c (2020) Model 18.2c (2020) - software transition           Label
1         1.79154e+03                              1.79154e+03           TOTAL
2         7.01686e-14                              7.01686e-14           Catch
3         2.91819e-04                              2.91819e-04     Equil_catch
4        -3.63359e+01                             -3.63359e+01          Survey
5         2.11536e+02                              2.11536e+02     Length_comp
6         1.61011e+03                              1.61011e+03        Age_comp
7         6.22357e+00                              6.22357e+00     Recruitment
11        3.35616e-03                              3.35616e-03 Parm_softbounds</code></pre>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Spawning Biomass</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Survey Fits</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Recruitment Time Series</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Unfished Recruitment</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ss_version_bridge/compare2_spawnbio_uncertainty.png" class="img-fluid figure-img" width="975"></p>
<figcaption class="figure-caption">The spawning biomass trajectory and associated uncertainty are identical between models</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ss_version_bridge/compare13_indices.png" class="img-fluid figure-img" width="975"></p>
<figcaption class="figure-caption">Survey fits are identical between models</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ss_version_bridge/compare10_recruits_uncertainty.png" class="img-fluid figure-img" width="975"></p>
<figcaption class="figure-caption">The recruitment time series and associated uncertainty are identical between models</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ss_version_bridge/compare16_densities_SR_LN(R0).png" class="img-fluid figure-img" width="975"></p>
<figcaption class="figure-caption">The R0 posteriors are identical between models</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="ss3-bridging-conclusion" class="level2">
<h2 class="anchored" data-anchor-id="ss3-bridging-conclusion">SS3 Bridging Conclusion</h2>
<p>Based on the above explorations, I am comfortable that moving to the latest SS3 version is not impacting model behavior. After completing this exercise, I addressed the <code>warnings</code> in the latest model via the following:</p>
<ul>
<li>Change <code>recr_dist_method</code> to 4 (line 17) and removing associated stuff lines 99-101</li>
<li>Change the <code>INIT</code> for Age_DblN_end_logit_Survey to 20 and the MAX to 25 to get rid of the bound error. The selectivity is the same.</li>
</ul>
<p>The warning-free model is in <code>model_runs/18.2c_2020_ss3v33022w</code>.</p>
</section>
</section>
<section id="data-exploration" class="level1">
<h1>Data Exploration</h1>
<section id="big-picture-data-notes" class="level2">
<h2 class="anchored" data-anchor-id="big-picture-data-notes">Big-Picture Data Notes</h2>
<p>This section of the script assumes that one has already downloaded and formatted the data one plans to use in the assesssment. To avoid separate scripts doing the same thing, I’m completing that step in <code>R/2024_analysis.R</code>. I wrote some functions for the <code>afscdata</code> and <code>afscassess</code> packages that reshape those data frames into the SS3 format, which is also accomplished in that script.</p>
<p>The original data pull method is in <code>R/old_datapull_script.R</code>. I used that code to download data in the manner consistent with the historical approach, when possible, and below reshape it into the SS3 format for comparison as a one-off. There are several cases where I wasn’t able to re-trace the 2020 model’s steps, mostly due to deprecated Oracle schemata.</p>
<p>Bering Flounder is <em>not</em> included in the compositional data; Dr.&nbsp;Monnahan caught and corrected this issue in 2020. The total survey biomass and catches do include both species.</p>
<section id="age-read-triaging" class="level3">
<h3 class="anchored" data-anchor-id="age-read-triaging">Age-Read triaging</h3>
<p><strong>Due to staffing issues</strong> we had to reduce the number of otoliths read for all sources in years 2022 and 2023. After consulting with the Age &amp; Growth team, they indicated they could read a <em>total</em> of about 750 BSAI FHS otoliths this year. This is a considerable (~75%) reduction given than normally we have about 600-800 otoliths for each source (survey and fishery) for each year; this typically encompasses every collected otolith from each source, so there are not historical ratios to use for guidance.</p>
<p>The two alternatives are to 1) disregard the fishery age-comps from 2022 &amp; 2023 for this assessment, and devote all reading effort to the survey or 2) find a compromise (split) among the two fleets and years that doesn’t amount to simply adding noise to the model.</p>
<p>The figures below illustrate simulated composition data at varying levels of age-reads. We evaluated the resultant datasets based on how distinct they appeared from the full dataset. Our findings were as follows:</p>
<ul>
<li>Simply splitting the 750 otoliths evenly across years &amp; fleets (187 reads each) results in a mis-represented plus group for the survey.</li>
<li>Based on the data weights in the 2020 model, and the fact that survey CAALs are used to inform growth, it’s intuitively preferable to assign more otolith reads to the survey data. This could range from completely ignoring the fishery data for these years to forming some sort of compromise among the datasets.</li>
<li>The data weights would suggest that 2.5x the number of otoliths should be read from the survey (equaling 267 survey otoliths per year). This approach results in satisfactory compositions for the survey but not for the fishery.</li>
<li>A compromise between these two approaches, shown in blue below, where the survey gets 225 age-reads per year, and the fishery gets 175 age-reads per year, result in satisfactory compositions for both fleets.</li>
</ul>
<p>After considering these results, Dr.&nbsp;Kapur decided in January 2024 to go with the first option and <strong>assign all available reader time to the survey</strong>, with the understanding that a) the A&amp;G program could finish reading the leftover fishery otoliths for future assessment years, and b) we don’t expect these simulated datasets to have a strong influence on the terminal derived quantities given that recruitment deviations are set to zero for the last three years.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Otolith Collections thru Time</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Simulated Fishery Ages</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Simulated Survey Ages</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Historical numbers of Bering Sea otoliths collected and read, by source. Survey collections from the AI remain unread. There is variation in the proportion of collected fishery otoliths that were read through time. The survey has consistently read nearly all collected otoliths. The red bars are the proposed number of age-reads for 2022 and 2023 data.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Experimental visualization of simulated fishery age-comp data using fewer otolith reads.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Experimental visualization of simulated survey age-comp data using fewer otolith reads. These are simulated using marginal age comp data from females in 2019.</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="fishery-catches" class="level2">
<h2 class="anchored" data-anchor-id="fishery-catches">Fishery Catches</h2>
<p>Both queries call from the <code>council.comprehensive_blend_ca</code> table. I ran the <code>afscassess::clean_catch()</code> function on the downloaded data, and the summary code for aggregating into tons. <strong>The approaches result in consistent catch histories,</strong> with the understandable exception of in-year catches for 2020 (which were under-estimated).</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2024_bridging_analysis_files/figure-html/load%20dfs-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fishery-length-compositions" class="level2">
<h2 class="anchored" data-anchor-id="fishery-length-compositions">Fishery Length Compositions</h2>
<p><em>I was unable to reproduce the fishery age- and len-comp routine</em> used for the older version of the model. For reproducibility purposes, I am going to move towards the <code>afscdata</code> approach, which requires about 10% of the code to run, and does not require multiple reads of the same data sources. Importantly, I tested Model 18.2c with <em>only</em> the age-comp or len-comp data (separately) changed to those available using my new approach and found the impact on derived quantities to be trivial.</p>
<p>The current assessment passes the fishery length comp time series but only fits to data in years where there are not age-comp data (1977-1999, 2002-2003, 2008 and 2020).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Fish Len Comps from 18.c (2020)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Fish Len Comps using <code>afscdata</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Spawning Biomass, old vs new length comp data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Recruitment Time Series, old vs new length comp data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false" href="">Survey Fits, old vs new length comp data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false" href="">Input Sample Sizes, Fishery Length Data</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">By manual inspection of the values and data plots, the outcomes are very similar, but not identical. It appears there is a slight squashing of observations towards older ages; the input sample sizes are essentially unchanged.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">By manual inspection of the values and data plots, the outcomes are very similar, but not identical. It appears there is a slight squashing of observations towards older ages; the input sample sizes are essentially unchanged.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">

</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">

</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>showing uncertainty for all models</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>subplot 13: index fits</code></pre>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">The discrepancies between the number of hauls is more pronounced earlier in the time series; the afscdata() approach seems to have slightly higher values. This is likely due to filtration steps in the old code that I cannot test by hand. There are missing years in the 2000’s because those data were not fit to (in lieu of age data).</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fishery-age-compositions" class="level2">
<h2 class="anchored" data-anchor-id="fishery-age-compositions">Fishery Age Compositions</h2>
<p>The old datapull script and <code>afscdata</code> both read from <code>norpac.debriefed_spcomp</code>, though the latter reads from <code>mv</code> and the former doesn’t. - Years 1994, 1995 and 1998 are not used in the model as length comp data are available. - The number of hauls is used as the input sample size; these values were recoverable for the age data using the <code>afscdata</code> approach, but the values for the length data are fairly different (see figure below). My guess is this has to do with updates to the database and/how filtration happens before compiling the comps. - The default <code>afscdata</code> approach did not have a means for getting sex-specific values for either comp dataset; I simply added these to the summary calls (ignoring unsexed fish) and reformatting things in SS3.</p>
<p>See the comments on the figures below for more information.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Fish Age Comps from 18.c (2020)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Fish Age Comps using <code>afscdata</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Spawning Biomass, old vs new age data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Recruitment Time Series, old vs new age data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false" href="">Survey Fits, old vs new age data</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">By manual inspection of the values and data plots, the outcomes are very similar, but not identical. It appears there is a slight squashing of observations towards older ages; the input sample sizes are essentially unchanged.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">By manual inspection of the values and data plots, the outcomes are very similar, but not identical. It appears there is a slight squashing of observations towards older ages; the input sample sizes are essentially unchanged.</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">

</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">

</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>showing uncertainty for all models</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>subplot 13: index fits</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>I am satisfied by this exploration that replacing the fishery compositional data with the outputs of <code>afscdata</code> does not have an unreasonable impact on model behavior, even given small changes in the observations.</strong></p>
</section>
<section id="survey-biomass-data" class="level2">
<h2 class="anchored" data-anchor-id="survey-biomass-data">Survey Biomass Data</h2>
<p>From the 2020 SAFE:</p>
<blockquote class="blockquote">
<p>“This assessment used a single survey index of”total” <em>Hippoglossoides</em> spp. biomass that included the EBS “standard” survey areas and AI survey areas for the years 1982-2018. Survey biomass for <em>Hippoglossoides</em> spp. in the Aleutian Islands is very small as compared to that from the EBS shelf survey, and survey biomass for Bering flounder is very small as compared to that of flathead sole. A linear regression is used to estimate a relationship between EBS shelf <em>Hippoglossoides</em> spp. survey biomass estimates and AI survey biomass estimates; this relationship is used to estimate AI survey biomass in years when no AI survey occurred (by using the linear equation to find an AI biomass estimate in a particular year based on the EBS biomass estimate for that year).”</p>
</blockquote>
<p>Both Dr.&nbsp;Monnohan (per his notes) and I are not thrilled with this approach, since being model-based means that even historical datapoints can change with each new observation (assuming that the output of the lm is used to replace the survey biomass series wholesale, which would be statistically prudent). It’s also odd to me that the survey biomass data include both congeners while the compositional data does not; though it’s important to remember that Bering flounder constitutes about 1% of catches.</p>
<p>I coded the linear model into the <code>afscdata::bsai_fhs</code> data extraction function and did <em>not</em> use the <code>afscassess::bts_biomass</code> function for further post-processing. The former function saves the Synthesis-formatted dataframe directly to <code>output/</code>. The resultant index is identical to what was used before.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="survey-compositional-data" class="level2">
<h2 class="anchored" data-anchor-id="survey-compositional-data">Survey Compositional Data</h2>
<section id="survey-caals" class="level3">
<h3 class="anchored" data-anchor-id="survey-caals">Survey CAALs</h3>
<p>I was unable to reproduce the CAAL data used in 2020 with my own methods: starting with the <code>_specimen</code> data from either <code>afscdata()</code> or <code>gapindex</code> and running an intuitive calculation resulted in very different datasets (and derived quantities). The only thing that came close was to recycle Carey’s code to workup on the <code>AL.df</code> object corresponds to <code>2020/data/ages_survey_ebs.csv</code> which is the roughly the same as what comes out of <code>_specimen</code>. So, I consolidated the code used in the last model into <code>R/calculate_survey_comps.R</code>. I suspect that the <code>gapindex</code> data pull has some behind-the-scenes summary steps (e.g., those leading to the MEAN length column) that render it distinct from the raw specimen data, and that my “creative” use of <code>dplyr</code> might be masking discrepancies in summary methods.</p>
<p>In addition, the <code>afscassess</code> package is not ready to handle the BSAI survey data, so marginal calculations had to be done with my own functions in <code>R/</code>.</p>
<p>The model uses survey conditional age-at-length data and marginal length composition data. The marginal survey <em>ages</em> are ghosted into the model for plotting purposes. The workflow for these data are as follows:</p>
<ul>
<li>Pull the raw data from <code>racebase</code> using the <code>afscdata</code> approach (see <code>2024_analysis.R</code>)</li>
<li>Calculate the marginal survey ages from <code>bsai_length_specimen.csv</code>.</li>
<li>Calculate the marginal survey lengths from <code>bsai_length_data.csv</code>.</li>
<li>Calculate conditional ages-at-length for each sex via the following: Starting with the EBS ages, filter out Bering Flounder (code <code>10140</code>) and only include the EBS (subarea &lt;= 6) and sexed fish (3). Bin the data into length and age bins greater than 0 (legacy code <code>BIN_AGE_DATA</code> and <code>BIN_LEN_DATA</code>). Group by bins and tabulate the number in each unique combination; filling missing values from zero. Reformat into SS3 syntax.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Survey CAALs from 18.c (2020)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Survey CAALs using <code>afscdata</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">Spawning Biomass, old vs new survey CAAL data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false" href="">Recruitment Time Series, new survey CAAL data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false" href="">Survey Fits, old vs new survey CAAL data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-6" role="tab" aria-controls="tabset-5-6" aria-selected="false" href="">Growth Curves, old vs new survey CAAL data</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-27-4.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-28-3.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-28-4.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">

</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">

</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>showing uncertainty for all models</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>subplot 13: index fits</code></pre>
</div>
</div>
</div>
<div id="tabset-5-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-6-tab">
<div class="cell">
<div class="cell-output-display">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" style="width:150.0%"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="survey-marginal-lengths" class="level2">
<h2 class="anchored" data-anchor-id="survey-marginal-lengths">Survey Marginal Lengths</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Survey lengths from 18.c (2020)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Survey lengths using <code>afscdata</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">Spawning Biomass, old vs new survey lengths</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false" href="">Recruitment Time Series, new survey lengths</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" role="tab" aria-controls="tabset-6-5" aria-selected="false" href="">Survey Fits, old vs new survey lengths</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-6" role="tab" aria-controls="tabset-6-6" aria-selected="false" href="">Growth Curves, old vs new survey lengths</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (shown here) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (next tab).</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Only trivial differences in this historical data provided to the original assessment (previous tab) vs.&nbsp;those pulled using a combination of afscdata and the legacy code (shown here).</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">

</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">

</div>
<div id="tabset-6-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-5-tab">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>showing uncertainty for all models</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>subplot 13: index fits</code></pre>
</div>
</div>
</div>
<div id="tabset-6-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-6-tab">
<div class="cell">
<div class="cell-output-display">
<p><img src="2024_bridging_analysis_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="survey-ages-ghosted" class="level2">
<h2 class="anchored" data-anchor-id="survey-ages-ghosted">Survey Ages (ghosted)</h2>
<p>These aren’t used in the model but I wanted to confirm the pull from <code>afscdata</code> looked reasonable.</p>
</section>
</section>
<section id="data-bridging" class="level1">
<h1>Data Bridging</h1>
<p>Importantly, the data updates conducted here are holistic, meaning that the entire time series of data for each component (where available) is replaced with what is currently available in the AKFIN database. A comparison between the data used in the last assessment and the latest version of that dataset is provided for each component above. The model that includes each change is named in the relevant header; these are hosted under <code>model_runs/</code>.</p>
<section id="timeseries-prep" class="level2">
<h2 class="anchored" data-anchor-id="timeseries-prep">Timeseries Prep</h2>
<p>Some initial steps are required to model dynamics through the present year. These are as follows: - end year - selex - forecasting file/doesn’t matter</p>
</section>
<section id="adding-catches" class="level2">
<h2 class="anchored" data-anchor-id="adding-catches">Adding Catches</h2>
</section>
<section id="adding-survey-biomass" class="level2">
<h2 class="anchored" data-anchor-id="adding-survey-biomass">Adding Survey Biomass</h2>
</section>
<section id="adding-survey-caals" class="level2">
<h2 class="anchored" data-anchor-id="adding-survey-caals">Adding Survey CAALs</h2>
</section>
<section id="adding-fishery-lengths" class="level2">
<h2 class="anchored" data-anchor-id="adding-fishery-lengths">Adding Fishery Lengths</h2>
</section>
<section id="adding-fishery-ages" class="level2">
<h2 class="anchored" data-anchor-id="adding-fishery-ages">Adding Fishery Ages</h2>
</section>
<section id="marginal-survey-ages-lengths-ghosted" class="level2">
<h2 class="anchored" data-anchor-id="marginal-survey-ages-lengths-ghosted">Marginal Survey Ages &amp; Lengths (ghosted)</h2>
</section>
</section>
<section id="bridged-operational-update-model-18.2c-2024" class="level1">
<h1>Bridged Operational Update Model, 18.2c (2024)</h1>
<p>This is model 18.2c (2024) and represents an “operational update”; the model structure has not been modified, and only the input data have been revised to reflect the current database. Additional explorations with this model that extend beyond the scope of an “operational update” are provided in <code>2024_sensitivity_analysis.qmd</code>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>