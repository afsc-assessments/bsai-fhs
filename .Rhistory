sex=ifelse(SEX==1,2,1),
Nsamp = HAULJOIN) %>%
select(YEAR, month, Fleet,sex,Part, Ageerr, Lbin_lo,Lbin_hi, Nsamp, 4:24)
srv_age_ss <-  bind_cols(filter(srv_age_ss0, sex ==1),
filter(srv_age_ss0, sex == 1) %>% select(10:30)) %>%
mutate(sex = 3) %>%
arrange(sex, year)
write.csv(srv_age_ss, file = here::here(year,'data','output','srv_age_ss3-gapindex-ghost.csv'),
row.names = FALSE)
srv_age_ss0 <- production_agecomp %>%
select(-SURVEY, - SURVEY_DEFINITION_ID, -AREA_ID, -POPULATION_COUNT ) %>%
filter(!is.na(AGE) & AGE>0 & !is.na(LENGTH_MM_MEAN) & SEX!=3) %>%
mutate(AGE = ifelse(AGE > plus_age,plus_age,AGE)) %>%
group_by(YEAR, SEX, AGE) %>%
summarise(Num_Fish = n(), .groups='drop') %>%
merge(., nsamp_age, by = 'YEAR') %>%
tidytable::left_join(expand.grid(SEX = unique(.$SEX),
YEAR = unique(.$YEAR),
AGE = 1:plus_age), .) %>%
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>% replace(is.na(.), 0) %>%
mutate(month = 7, Fleet = -2, Part = 0, Ageerr = 1, Lbin_lo = -1, Lbin_hi =-1,
sex=ifelse(SEX==1,2,1),
Nsamp = HAULJOIN) %>%
select(YEAR, month, Fleet,sex,Part, Ageerr, Lbin_lo,Lbin_hi, Nsamp, 4:24)
srv_age_ss <-  bind_cols(filter(srv_age_ss0, sex ==1),
filter(srv_age_ss0, sex == 1) %>% select(10:30)) %>%
mutate(sex = 3) %>%
arrange(sex, year)
srv_age_ss
View(srv_age_ss)
filter(srv_age_ss0, sex ==1)
srv_age_ss <-  bind_cols(filter(srv_age_ss0, sex ==1),
filter(srv_age_ss0, sex == 2) %>% select(10:30)) %>%
mutate(sex = 3) %>%
arrange(sex, year)
filter(srv_age_ss0, sex == 2)
merge(filter(srv_age_ss0, sex ==1),   filter(srv_age_ss0, sex == 2), by = 'YEAR')
merge(filter(srv_age_ss0, sex ==1),   filter(srv_age_ss0, sex == 2), by = 'YEAR', all.y = FALSE)
merge(filter(srv_age_ss0, sex ==1),
filter(srv_age_ss0, sex == 2),
by = 'YEAR', all.y = FALSE, all.x = TRUE)
# mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_lengths'))
mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_len'))
compsummary_4 <- SSsummarize(list(mod_2020,mod_2020_new_srv_len))
SSplotComps(mod_2020,fleets=2, subplots = 1, kind = 'LEN',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
# mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex-specimen'))
mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal'))
compsummary_3 <- SSsummarize(list(mod_2020,mod_2020_new_srv_caal))
SSplotComps(mod_2020,fleets=2, subplots = 3, kind = 'cond',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
library(r4ss)
library(here)
library(dplyr)
library(ggplot2)
theme_set(afscassess::theme_report())
colvec <- c("dodgerblue4", "#ffb703","#219ebc", "#023047",  "#fb8500")
year <- 2024
old_mdl_fldr <- here::here(year,'mgmt','18.2c_2020')
mod18.2c_2020 <- mod_2020 <- SS_output(old_mdl_fldr, verbose = FALSE)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
# mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex-specimen'))
mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal'))
compsummary_3 <- SSsummarize(list(mod_2020,mod_2020_new_srv_caal))
SSplotComps(mod_2020,fleets=2, subplots = 3, kind = 'cond',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
# mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_lengths'))
mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_len'))
compsummary_4 <- SSsummarize(list(mod_2020,mod_2020_new_srv_len))
SSplotComparisons(compsummary_4,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new survey length data'),
subplots = 2)
## CAALS----
caal <- production_agecomp %>%
select(-SURVEY, - SURVEY_DEFINITION_ID, -AREA_ID, -POPULATION_COUNT ) %>%
filter(!is.na(AGE) & AGE>0 & !is.na(LENGTH_MM_MEAN) & SEX!=3) %>%
mutate(AGE = ifelse(AGE > plus_age,plus_age,AGE)) %>%
mutate(
length_grp = cut(round(LENGTH_MM_MEAN/10,0) ,
breaks = seq(6,58,2),
right = FALSE,
labels = FALSE),
length_bin_use = seq(6,58,2)[length_grp]) %>%
group_by(YEAR, SEX, AGE, length_bin_use) %>%
summarise(Num_Fish = n(), .groups='drop') %>%
# summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
## arange by AGE so bins are in right order below
# rename(AGE=aBIN) %>%
arrange(AGE) %>%
group_by(SEX, YEAR, length_bin_use) %>%
mutate(Nsamp=sum(Num_Fish)) %>%
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0)
SS_caal_survey <-
data.frame(year=caal$YEAR, Month=7, Fleet=2,
sex=ifelse(caal$SEX==1,2,1), ## SS sex is reversed
Part=0, Ageerr=1,
Lbin_lo=caal$length_bin_use, Lbin_hi=caal$length_bin_use,
Nsamp=caal$Nsamp,
## Double up b/c SS needs dummy columns
caal[,-(1:4)], caal[,-(1:4)]) %>%
arrange(sex, year, Lbin_lo)
SS_caal_survey
caal00 <-   production_data$specimen %>%
## filter out bering flounder and unsexed
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
## deal with plus groups
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
## make integer-based length bin
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
## calculate number of samples in each age-length bin (Obs)
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
## calculate the number of samples in each length bin (inputN)
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
## reshape to ss3 format
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 'males',2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp=value,everything())
caal00 <-   production_data$specimen %>%
## filter out bering flounder and unsexed
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
## deal with plus groups
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
## make integer-based length bin
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
## calculate number of samples in each age-length bin (Obs)
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
## calculate the number of samples in each length bin (inputN)
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
## reshape to ss3 format
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 'males',2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp=value,everything()) %>%
write.csv(., file = here::here(year,'data','output','srv_caal_ss3-gapindex.csv'),
row.names = FALSE)
srvlen0 %>%
filter(SEX == 1) %>%
merge(., srvlen0 %>%
filter(SEX == 2) %>%
select(-SEX, -HAULJOIN),
by = c('YEAR'), all.y = FALSE) %>%
mutate(Seas = 7, FltSvy = 2, Gender = 3, Part = 0,) %>%
select(Yr = YEAR, Seas, FltSvy, Gender, Part, Nsamp=HAULJOIN, everything(),
-SEX) %>%
arrange(Yr) %>%
write.csv(., file = here::here(year,'data','output','srv_len_ss3-gapindex.csv'),
row.names = FALSE)
srvlen0 <- survlen %>%
tidyr::pivot_wider(names_from = LENGTH_BIN, values_from = freq, id_cols = c(YEAR, SEX), values_fill = 0) %>%
mutate(SEX = ifelse(SEX == 'males',2,1)) %>%
merge(., nsamp_len, by = 'YEAR')
#   left_join(., nsamp_len, by = 'YEAR') %>%
#   mutate(Yr = YEAR, Seas = 7, Fleet=2,
#          Sex = SEX, Part = 0,
#          Nsamp = HAULJOIN) %>%
#   select(Yr, Seas, Fleet, Sex, Part,  Nsamp, 3:26) %>%
#   bind_cols(., select(., 7:30))
#
#
# write.csv(ss_len_survey, file = here::here(year,'data','output','srv_len_ss3-gapindex.csv'),
#           row.names = FALSE)
survlen <- production_sizecomp_stratum %>%
filter(SEX != 3) %>%
mutate(SEX = ifelse(SEX == 1, 'males','females'),
LENGTH_MM  = ifelse(LENGTH_MM < 60, 60.5,LENGTH_MM),
LENGTH_MM = ifelse(LENGTH_MM >= 580, 580, LENGTH_MM))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM/10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
select(-first, -second) %>%
group_by(YEAR, LENGTH_BIN, SEX) %>%
summarise(value = sum(POPULATION_COUNT))   %>%
ungroup()%>%
mutate(tot = sum(value), .by = c(YEAR)) %>%
mutate(freq = value/tot)
srvlen0 <- survlen %>%
tidyr::pivot_wider(names_from = LENGTH_BIN, values_from = freq, id_cols = c(YEAR, SEX), values_fill = 0) %>%
mutate(SEX = ifelse(SEX == 'males',2,1)) %>%
merge(., nsamp_len, by = 'YEAR')
srvlen0 %>%
filter(SEX == 1) %>%
merge(., srvlen0 %>%
filter(SEX == 2) %>%
select(-SEX, -HAULJOIN),
by = c('YEAR'), all.y = FALSE) %>%
mutate(Seas = 7, FltSvy = 2, Gender = 3, Part = 0,) %>%
select(Yr = YEAR, Seas, FltSvy, Gender, Part, Nsamp=HAULJOIN, everything(),
-SEX) %>%
arrange(Yr) %>%
write.csv(., file = here::here(year,'data','output','srv_len_ss3-gapindex.csv'),
row.names = FALSE)
message('saved survey length comp data to output/')
srvage0 %>%
filter(SEX == 1) %>%
merge(., srvage0 %>%
filter(SEX == 2) %>%
select(-SEX, -HAULJOIN),
by = c('YEAR'), all.y = FALSE) %>%
mutate(Seas = 7, FltSvy = -2, Gender = 3, Part = 0,Ageerr = 1, Lbin_lo = -1) %>%
select(Yr = YEAR, Seas, FltSvy, Gender, Part, Ageerr, Lbin_lo = Lbin_lo, Lbin_hi = Lbin_lo, Nsamp=HAULJOIN, everything(),
-SEX) %>%
arrange(Yr) %>%
write.csv(., file = here::here(year,'data','output','srv_age_ss3-gapindex-ghost.csv'),
row.names = FALSE)
## Reformat Survey Ages (ghost) ----
srvage0 <- survage %>%
mutate(AGE = as.numeric(AGE)) %>%
tidyr::pivot_wider(names_from = AGE, values_from = freq, id_cols = c(YEAR, SEX), values_fill = 0) %>%
mutate(SEX = ifelse(SEX == 'males',2,1)) %>%
merge(., nsamp_age, by = 'YEAR') %>%
select(YEAR, SEX, HAULJOIN, paste0(1:21)) ## ensure correct order
survage <- production_agecomp %>%
filter(SEX != 3 & AGE > 0) %>%
mutate(SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH_MM_MEAN  < 60, 60.5,LENGTH_MM_MEAN ),
LENGTH_MM = ifelse(LENGTH_MM_MEAN  >= 580, 580, LENGTH_MM_MEAN ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM_MEAN /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
select(-first, -second) %>%
summarise(value = sum(POPULATION_COUNT), .by = c(YEAR,AGE,SEX))   %>%
mutate(tot = sum(value), .by = c(YEAR)) %>%
mutate(freq = value/tot)
srvage0 <- survage %>%
mutate(AGE = as.numeric(AGE)) %>%
tidyr::pivot_wider(names_from = AGE, values_from = freq, id_cols = c(YEAR, SEX), values_fill = 0) %>%
mutate(SEX = ifelse(SEX == 'males',2,1)) %>%
merge(., nsamp_age, by = 'YEAR') %>%
select(YEAR, SEX, HAULJOIN, paste0(1:21)) ## ensure correct order
srvage0 %>%
filter(SEX == 1) %>%
merge(., srvage0 %>%
filter(SEX == 2) %>%
select(-SEX, -HAULJOIN),
by = c('YEAR'), all.y = FALSE) %>%
mutate(Seas = 7, FltSvy = -2, Gender = 3, Part = 0,Ageerr = 1, Lbin_lo = -1) %>%
select(Yr = YEAR, Seas, FltSvy, Gender, Part, Ageerr, Lbin_lo = Lbin_lo, Lbin_hi = Lbin_lo, Nsamp=HAULJOIN, everything(),
-SEX) %>%
arrange(Yr) %>%
write.csv(., file = here::here(year,'data','output','srv_age_ss3-gapindex-ghost.csv'),
row.names = FALSE)
# mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex-specimen'))
mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal'))
compsummary_3 <- SSsummarize(list(mod_2020,mod_2020_new_srv_caal))
SSplotComps(mod_2020,fleets=2, subplots = 3, kind = 'cond',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComps(mod_2020_new_srv_caal,fleets=2, subplots = 3, kind = 'cond',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
# mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_lengths'))
mod_2020_new_srv_len <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_len'))
compsummary_4 <- SSsummarize(list(mod_2020,mod_2020_new_srv_len))
SSplotComps(mod_2020,fleets=2, subplots = 1, kind = 'LEN',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
SSplotComparisons(compsummary_4,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new survey length data'),
subplots = 2)
mod_2020_new_srv_bio <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_biomass'))
compsummary_b <- SSsummarize(list(mod_2020,mod_2020_new_srv_bio))
SSplotComparisons(compsummary_b,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new survey data'),
subplots = 2)
SSplotComparisons(compsummary_b,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new survey biomass data'),
subplots = 12)
SSplotComparisons(compsummary_b,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new survey biomass data'),
subplots = 13)
?SSplotComparisons
SSplotComparisons(compsummary_b,
indexPlotEach = TRUE,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new survey biomass data'),
subplots = 13, data)
SSplotComparisons(compsummary_b,
indexPlotEach = TRUE,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new survey biomass data'),
subplots = 13)
## Aggregate catch to just year
rbind( mod_2020$catch %>% select(Yr, Obs) %>%
mutate(src = 'Old'),
read.csv(here(year,'data','output','fsh_catch_ss3.csv')) %>% mutate(src = 'New') %>% select(Yr = year, Obs = catch_t, src) ) %>%
ggplot(., aes(x = Yr, y = Obs, col = src )) +
geom_line() +
scale_color_manual(values = c('blue','grey22'),
labels = c('2024 Model Data', '2020 Model Data'))+
labs(x = 'Year', y = 'Observed Catch (t)', color = '') +
geom_vline(data = NULL, aes(xintercept = 2020), linetype = 'dotted', color = 'grey66')
rbind( mod_2020$catch %>% select(Yr, Obs) %>%
mutate(src = 'Old'),
read.csv(here(year,'data','output','fsh_catch_ss3.csv')) %>% mutate(src = 'New') %>% select(Yr = year, Obs = catch_t, src) )
rbind( mod_2020$catch %>% select(Yr, Obs) %>%
mutate(src = 'Old'),
read.csv(here(year,'data','output','fsh_catch_ss3.csv')) %>% mutate(src = 'New') %>% select(Yr = year, Obs = catch_t, src) ) %>%
filter(Yr < year) %>%
ggplot(., aes(x = Yr, y = Obs, col = src )) +
geom_line() +
scale_color_manual(values = c('blue','grey22'),
labels = c('2024 Model Data', '2020 Model Data'))+
labs(x = 'Year', y = 'Observed Catch (t)', color = '') +
geom_vline(data = NULL, aes(xintercept = 2020), linetype = 'dotted', color = 'grey66')
SSplotComparisons(compsummary_2,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new length comp data'),
subplots = 2)
SSplotComparisons(compsummary_2,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new length comp data'),
subplots = 2)
mod_2020_new_fsh_age_comps <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_fsh_age_comps'))
mod_2020_new_fsh_len_comps <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_fsh_len_comps'))
compsummary_1 <- SSsummarize(list(mod_2020,mod_2020_new_fsh_age_comps))
compsummary_2 <- SSsummarize(list(mod_2020,mod_2020_new_fsh_len_comps))
SSplotComparisons(compsummary_2,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new length comp data'),
subplots = 2)
SSplotComparisons(compsummary_2,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new length comp data'),
subplots = 12)
SSplotComparisons(compsummary_2,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new length comp data'),
subplots = 13)
knitr::include_graphics(here::here(old_mdl_fldr,'plots','comp_gstagedat_flt2mkt0.png'))
mod_2020_new_fsh_age_comps <- SS_output(here(year, 'model_runs','01_data_checks','18.2c_2020_ss3v33022w-new_fsh_age_comps'))
m18.2cv33022w <- SS_output(here::here(year,'model_runs','00_software_trans','18.2c_2020_ss3v33022w'), verbose = FALSE)
afscdata::catch_to_ss3
# load ----
## do NOT update odbc or connect() won't work
devtools::install_github("afsc-assessments/afscdata", force = TRUE)
library(gapindex)
library(afscdata)
library(afscassess)
library(r4ss)
library(dplyr)
library(here)
library(ggplot2)
theme_set(afscassess::theme_report())
afscdata::catch_to_ss3
# load ----
## do NOT update odbc or connect() won't work
devtools::install_github("afsc-assessments/afscdata", force = TRUE)
library(gapindex)
library(afscdata)
library(afscassess)
library(r4ss)
library(dplyr)
library(here)
library(ggplot2)
theme_set(afscassess::theme_report())
afscdata::catch_to_ss3
## reformat catches
afscdata::catch_to_ss3(year, seas = 1, fleet = 1)
## reformat catches
afscdata::catch_to_ss3(year, seas = 1, fleet = 1, yld_rat = TRUE)
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod_2020,mod02_00))
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod_2020,mod02_00))
SSplotComparisons(compsummary_6, legendlabels = llabs)
```{r,  include=T, eval = TRUE, echo = FALSE, warning = FALSE, message =FALSE, fig.cap="No change in derived quantities."}
llabs
SSplotComparisons(compsummary_6, legendlabels = llabs)
?SSplotComparisons
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = 2024)
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024))
SSplotTimeseries(mod02_00)
SSplotTimeseries(mod02_00,subplot = 1)
mod02_00$endyr
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024), add = TRUE)
quantities."}
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024)
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024)
)
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024), xlim = c(1960,2025))
compsummary_6
?SSsummarize
compsummary_6 <- SSsummarize(list(mod_2020,mod02_00))
compsummary_6
devtools::install_git('r4ss/r4ss')
devtools::install_git('r4ss/r4ss')
devtools::install_github('r4ss/r4ss')
library(r4ss)
library(r4ss)
library(here)
library(dplyr)
library(ggplot2)
theme_set(afscassess::theme_report())
colvec <- c("dodgerblue4", "#ffb703","#219ebc", "#023047",  "#fb8500")
year <- 2024
old_mdl_fldr <- here::here(year,'mgmt','18.2c_2020')
mod18.2c_2020 <- mod_2020 <- SS_output(old_mdl_fldr, verbose = FALSE)
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod_2020,mod02_00))
compsummary_6
## a dummy version of 18.2c(2020)-w with endyr set to 2024, so plotting works
mod01_99 <- SS_output(here(year, 'model_runs','02_bridging','01.99_18.2c_2020_ss3v33022w-2024'))
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_6
mod01_99$endyr
SSplotTimeseries(mod01_99,subplot =1 )
## a dummy version of 18.2c(2020)-w with endyr set to 2024, so plotting works
mod01_99 <- SS_output(here(year, 'model_runs','02_bridging','01.99_18.2c_2020_ss3v33022w-2024'))
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
SSplotComparisons(compsummary_6, legendlabels = llabs, endyrvec = c(2024,2024), xlim = c(1960,2025))
list(mod01_99,mod02_00)[[1]][["timeseries"]][["Yr"]]
list(mod01_99,mod02_00)[[2]][["timeseries"]][["Yr"]]
SSsummarize(list(mod01_99,mod02_00))
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_6$SpawnBio
SS_output("M:/Spies/AI_PCOD2024/Models/Sensitivity_Anal/M23.2_base/M23_2_base/run")
list(mod01_99,mod02_00)[[1]][["timeseries"]][["Yr"]]
list(mod01_99,mod02_00)[[2]][["timeseries"]][["Yr"]]
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_6$SpawnBio
mod01_99 <- SS_output(here(year, 'model_runs','02_bridging','01.99_18.2c_2020_ss3v33022w-2024'))
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
list(mod01_99,mod02_00)[[1]][["timeseries"]][["Yr"]]
list(mod01_99,mod02_00)[[2]][["timeseries"]][["Yr"]]
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_6$SpawnBio
mod01_99 <- SS_output(here('2020', 'model_runs','Run00_2018_final_original'))
mod02_00 <- SS_output(here('2020', 'model_runs','Run04_2020_new_data'))
list(mod01_99,mod02_00)[[1]][["timeseries"]][["Yr"]]
list(mod01_99,mod02_00)[[2]][["timeseries"]][["Yr"]]
llabs <- c('18.2c (2020) warnings, software trans',
'+ catches'
)
compsummary_6 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_6$SpawnBio
mod01_99 <- SS_output(here(year, 'model_runs','02_bridging','01.99_18.2c_2020_ss3v33022w-2024'))
mod02_00 <- SS_output(here(year, 'model_runs','02_bridging','02.00_18.2c_2020_ss3v33022w-catches'))
compsummary_7 <- SSsummarize(list(mod01_99,mod02_00))
compsummary_7$SpawnBio
