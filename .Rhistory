arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
caal <-  data.frame(year=caal0$YEAR, Month=7, Fleet=2,
sex=ifelse(caal0$SEX==1,2,1), ## SS sex is reversed
Part=0, Ageerr=1,
Lbin_lo=caal$LENGTH_BIN, Lbin_hi=caal$LENGTH_BIN,
Nsamp=caal$Nsamp,
## Double up b/c SS needs dummy columns
caal0[,-(1:4)], caal0[,-(1:4)])
caal0$YEAR
caal0[,-(1:4)]
caal0
caal0 <- production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
ata.frame(year=caal0$YEAR,
Month=7, Fleet=2,
sex=ifelse(caal0$SEX==1,2,1), ## SS sex is reversed
Part=0, Ageerr=1,
Lbin_lo=caal$LENGTH_BIN,
Lbin_hi=caal$LENGTH_BIN,
Nsamp=caal$Nsamp,
## Double up b/c SS needs dummy columns
caal0[,-(1:4)], caal0[,-(1:4)])
data.frame(year=caal0$YEAR,
Month=7, Fleet=2,
sex=ifelse(caal0$SEX==1,2,1), ## SS sex is reversed
Part=0, Ageerr=1,
Lbin_lo=caal$LENGTH_BIN,
Lbin_hi=caal$LENGTH_BIN,
Nsamp=caal$Nsamp,
## Double up b/c SS needs dummy columns
caal0[,-(1:4)], caal0[,-(1:4)])
Lbin_lo=caal$LENGTH_BIN
caal0 <- production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
bind_cols(.[,-1:4])
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp, 5:ncol(.) )
names(production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN))
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_rows(., select(.,5:25))
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_rows(., select(.,5:25)) %>% head()
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_cols(., select(.,5:25)) %>%head()
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_cols(., select(.,5:25)) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>% head()
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_cols(., select(.,5:25)) %>%head()
production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN) %>%
bind_cols(., select(5:25)) %>%head()
bind_cols(caal0,caal0[,-1:4]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1)
caal0 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  c(seq(6,40,2),seq(43,61,3))))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-1:4])
caal0[,-1:4]
bind_cols(caal0,caal0[,-(1:4)])
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp, 5:ncol(.) )
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,everything())
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,everything())
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE))
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE)
max(mod_2020$condbase$Bin)
max(mod_2020$condbase$Lbin_lo)
mod_2020$lbinspop
caal0 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(Nsamp=sum(Num_Fish)) %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 1,2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE)
mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex-specimen'))
# mod_2020_new_srv_caalg <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex'))
compsummary_3 <- SSsummarize(list(mod_2020,mod_2020_new_srv_caal))
SSplotComps(mod_2020,fleets=2, subplots = 3, kind = 'cond',
datonly = TRUE, maxrows = 6,showsampsize = TRUE, showeffN = FALSE)
caal00 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
compare <- bind_rows(caal0 %>% mutate(SEX = ifelse(SEX == 'males',2,1), src = 'gapindex workup'),
mod_2020$condbase %>%
filter(Fleet == 2) %>%
mutate(value= NA, tot = NA,src = 'Model 18.2c (2020)')  %>%
select(YEAR = Yr, SEX = Sex, AGE = Bin,  LENGTH_BIN = Lbin_lo, value=Obs, src))
ggplot(subset(compare, YEAR > 1980 & YEAR < 2000),
aes(x= AGE, y= LENGTH_BIN, color = src, size = value)) +
geom_point(pch = 1)+
scale_color_manual(values = c('dodgerblue2','navy')) +
labs(x = 'Age', y= 'Length', size = 'Number Observed', color = '', title = 'early years; females in first row')+
facet_grid(SEX~YEAR)
caal00 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=value,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 'males',2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp=value,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE)
caal00 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=value,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
caal0
caal00 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
caal0
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 'males',2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp=value,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE)
caal00 <-   production_data$specimen %>%
filter(!is.na(AGE) & !is.na(LENGTH) & SEX != 3 & AGE > 0 & SPECIES_CODE == 10130 ) %>%
mutate(YEAR =  floor(x = CRUISE / 100),
SEX = ifelse(SEX == 1, 'males','females'),
AGE = ifelse(AGE  >= 21, 21, AGE ),
LENGTH_MM  = ifelse(LENGTH   < 60, 60.5,LENGTH ),
LENGTH_MM = ifelse(LENGTH   >= 580, 580, LENGTH ))  %>%
mutate( length_grp0 = cut(round(LENGTH_MM /10,0),
right = F,
breaks =  mod_2020$lbinspop))  %>%
tidyr::separate(length_grp0, c("first", "second"), sep = ",") %>%
mutate(LENGTH_BIN = as.numeric(substr(first,2,nchar(first)))) %>%
group_by(YEAR, SEX, AGE, LENGTH_BIN) %>%
summarize(Num_Fish=length(SPECIMENID), .groups='drop') %>%
arrange(AGE, SEX) %>%
group_by(SEX, YEAR, LENGTH_BIN) %>%
mutate(value=sum(Num_Fish))
caal0 <- caal00 %>% ## raw number of individuals
tidyr::pivot_wider(names_from=AGE, values_from=Num_Fish,
names_prefix='a', values_fill=0) %>%
arrange(YEAR, SEX, LENGTH_BIN)
bind_cols(caal0,caal0[,-(1:4)]) %>%
mutate(Seas = 7, Fleet = 2, SEX = ifelse(SEX == 'males',2,1),
Part = 0, Ageerr = 1) %>%
select(Yr = YEAR, Seas, Fleet, Sex =SEX, Part, Ageerr, Lbin_lo = LENGTH_BIN,
Lbin_hi = LENGTH_BIN, Nsamp=value,everything()) %>%
write.csv(file = here::here(year,'data','output','srv_caal_ss3-gapindex-specimen.csv'), row.names = FALSE)
mod_2020_new_srv_caal <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex-specimen'))
# mod_2020_new_srv_caalg <- SS_output(here(year, 'model_runs','18.2c_2020_ss3v33022w-new_srv_caal-gapindex'))
compsummary_3 <- SSsummarize(list(mod_2020,mod_2020_new_srv_caal))
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)',
'Model 18.2c (2020) with new CAAL data'),
subplots = 2)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new CAAL data'),
subplots = 12)
SSplotComparisons(compsummary_3,
legendlabels = c('Model 18.2c (2020)','Model 18.2c (2020) with new CAAL data'),
subplots = 13)
par(mfrow = c(1,2))
SSplotBiology(mod_2020,subplots = 1)
SSplotBiology(mod_2020_new_srv_caal,subplots = 1)
gapindex_size
head(gapindex_size)
